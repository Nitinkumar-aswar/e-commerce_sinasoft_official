<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title><%= product.product_name %> | AutoKart</title>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f1f3f6;
    }

    /* MAIN WRAPPER */
    .product-page {
  max-width: 100%;
  margin: 20px auto;
  background: #ffffff;
  padding: 24px 40px;
  display: flex;
  gap: 40px;
}

    /* LEFT SIDE */
    .product-left {
      width: 45%;
    }

    .product-image-box {
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      padding: 20px;
      text-align: center;
    }

    .product-image-box img {
      width: 100%;
      max-height: 100px;
      object-fit: contain;
    }

   .action-buttons {
  margin-top: 16px;
  display: flex;
  gap: 12px;
  width: 100%;
}

.add-cart-btn,
.buy-now-btn {
  width: 160px;
  height: 44px;

  border: none;
  border-radius: 4px;

  font-size: 14px;
  font-weight: 600;
  cursor: pointer;

  box-sizing: border-box;
}

.add-cart-btn {
  background: #ff9f00;
  color: #fff;
}

.buy-now-btn {
  background: #fb641b;
  color: #fff;
}

    
    /* RIGHT SIDE */
    .product-right {
      width: 60%;
    }

    .product-title {
      font-size: 22px;
      font-weight: 500; /* NOT too bold */
      color: #212121;
      margin-bottom: 10px;
      line-height: 1.4;
    }

    .product-price {
      font-size: 26px;
      font-weight: 600;
      color: #388e3c;
      margin: 15px 0;
    }

    .product-description-title {
      font-size: 16px;
      font-weight: 600;
      margin-top: 25px;
      margin-bottom: 10px;
      color: #212121;
    }

    .product-description {
      font-size: 14px;
      color: #555;
      line-height: 1.6;
    }

/* IMAGE GALLERY */
.image-gallery {
  display: flex;
  gap: 15px;
}

/* LEFT SMALL IMAGES */
.thumbnail-column {
  display: flex;
  flex-direction: column;
  gap: 1px;
}

.thumbnail-column img {
  width: 88px;
  height: 68px;
  object-fit: contain;   /* ðŸ‘ˆ KEY FIX */
  background: #fff;
}



.thumbnail-placeholder {
  width: 80px;
  height: 80px;
  border: 1px solid #ccc;
  object-fit: cover;
  cursor: pointer;
  background: #f5f5f5;
}

.thumbnail-column img:hover {
  border: 2px solid #2874f0;
}

/* MAIN IMAGE */
.main-image img {
  width: 100%;
  max-height: 420px;
  object-fit: contain;
}
.image-zoom-container {
  display: flex;
  gap: 20px;
  position: relative;
  width: 100%;
}


/* Main image */
.image-wrapper {
  position: relative;
  width: 420px;
  height: 420px;
  border: 1px solid #e0e0e0;
  overflow: hidden;
  background: #fff;
}

.image-wrapper img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

/* Lens */
#lens {
  position: absolute;
  width: 120px;
  height: 120px;
  background: rgba(0, 0, 0, 0.15);
  display: none;
  cursor: crosshair;

  pointer-events: none; /* ðŸ”¥ KEY FIX */
}


/* Zoom preview */
.zoom-preview {
  position: absolute;
  top: 0;
  left: calc(100% + 20px);
  width: 150%;
  height: 150%;

  border: 1px solid #e0e0e0;
  background-repeat: no-repeat;
  background-size: 350%;        /* ðŸ”¥ CLARITY BOOST */
  image-rendering: auto;        /* ðŸ”¥ SHARPER ZOOM */
  background-color: #fff;

  display: none;
  pointer-events: none;
  z-index: 10;
}



  </style>
</head>


<body>

<%- include('partials/header') %>
  
<div class="product-page">

  <!-- LEFT SIDE -->
  <div class="product-left">

    <!-- IMAGE GALLERY -->
    <div class="image-gallery">

      <!-- THUMBNAILS -->
      <div class="thumbnail-column">
        <% for (let i = 0; i < 5; i++) { %>
          <% if (images && images[i]) { %>
            <img
              src="/uploads/<%= images[i].image %>"
              onclick="changeImage('/uploads/<%= images[i].image %>')"
            >
          <% } else { %>
            <div class="thumbnail-placeholder"></div>
          <% } %>
        <% } %>
      </div>

      <!-- MAIN IMAGE -->
      <div class="image-zoom-container">
        <div class="image-wrapper">
          <img
            id="mainImage"
            src="/uploads/<%= product.image %>"
            alt="<%= product.product_name %>"
          >
          <div id="lens"></div>
        </div>
        <div class="zoom-preview" id="zoomPreview"></div>
      </div>

    </div>

    <!-- BUTTONS -->
    <div class="action-buttons">
      <button
        class="add-cart-btn"
        data-product-id="<%= product.id %>"
      >
        ADD TO CART
      </button>

      <button class="buy-now-btn">
        BUY NOW
      </button>
    </div>

  </div>

  <!-- RIGHT SIDE -->
  <div class="product-right">

    <div class="product-title">
      <%= product.product_name %>
    </div>

    <div class="product-price">
      â‚¹ <%= product.price %>
    </div>

    <div class="product-description-title">
      Description
    </div>

    <div class="product-description">
      <%= product.product_description || "No description available." %>
    </div>

  </div>

</div>


  <script>
const mainImage = document.getElementById("mainImage");
const lens = document.getElementById("lens");
const zoomPreview = document.getElementById("zoomPreview");

const zoomLevel = 2.5;



function moveLens(e) {
  e.preventDefault();

  const rect = mainImage.getBoundingClientRect();
  let x = e.clientX - rect.left - lens.offsetWidth / 2;
  let y = e.clientY - rect.top - lens.offsetHeight / 2;

  if (x < 0) x = 0;
  if (y < 0) y = 0;
  if (x > rect.width - lens.offsetWidth)
    x = rect.width - lens.offsetWidth;
  if (y > rect.height - lens.offsetHeight)
    y = rect.height - lens.offsetHeight;

  lens.style.left = x + "px";
  lens.style.top = y + "px";

  const fx = (x / rect.width) * 100;
  const fy = (y / rect.height) * 100;

  zoomPreview.style.backgroundPosition = `${fx}% ${fy}%`;
  zoomPreview.style.backgroundSize =
    rect.width * zoomLevel + "px " +
    rect.height * zoomLevel + "px";
}

mainImage.addEventListener("mouseenter", () => {
  lens.style.display = "block";
  zoomPreview.style.display = "block";
  zoomPreview.style.backgroundImage = `url(${mainImage.src})`;
});


mainImage.addEventListener("mouseleave", () => {
  lens.style.display = "none";
  zoomPreview.style.display = "none";
});

mainImage.addEventListener("mousemove", moveLens);
lens.addEventListener("mousemove", moveLens);
</script>

<script>
function changeImage(src) {
  const mainImage = document.getElementById("mainImage");
  const zoomPreview = document.getElementById("zoomPreview");

  mainImage.src = src;
  zoomPreview.style.backgroundImage = `url(${src})`;
}
</script>

<script>
document.querySelector(".add-cart-btn").addEventListener("click", function () {
  const productId = this.dataset.productId;

  fetch("/add-to-cart", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ productId, qty: 1 })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      alert("Added to cart");
    } else {
      alert("Failed to add to cart");
    }
  })
  .catch(err => console.error(err));
});
</script>





</body>
</html>