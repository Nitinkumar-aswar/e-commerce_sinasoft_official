
<h2 style="margin-bottom:20px;">
  Manage Sliders
</h2>

<!-- =========================
     TOP UPLOAD AREA
========================= -->
<div
  style="
    display:flex;
    gap:30px;
    margin-bottom:30px;
  "
>

  <!-- =========================
       IMAGE CROP / PREVIEW AREA
  ========================= -->
  <div
    style="
      width:50%;
      border:2px dashed #ccc;
      border-radius:6px;
      height:260px;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#fafafa;
      position:relative;
      overflow:visible;
    "
  >

    <img
  id="cropImage"
  src=""
  style="
    max-width:100%;
    max-height:100%;
    display:none;
  "
>


    <span
      id="cropHint"
      style="
        color:#999;
        font-size:14px;
      "
    >
      Select image to crop
    </span>

  </div>

  <!-- =========================
       UPLOAD CONTROLS
  ========================= -->
  <div
    style="
      width:50%;
    "
  >

    <label
      style="
        display:block;
        margin-bottom:10px;
        font-weight:bold;
      "
    >
      Select Slider Image
    </label>

    <input
      type="file"
      id="imageInput"
      accept="image/*"
      style="
        margin-bottom:15px;
      "
    >

    <br>

    <button
      type="button"
      onclick="uploadCroppedSlider()"
      style="
        background:#2874f0;
        color:white;
        border:none;
        padding:10px 20px;
        border-radius:4px;
        cursor:pointer;
        font-size:14px;
      "
    >
      Upload Slider
    </button>

  </div>

</div>

<hr
  style="
    margin:30px 0;
  "
>

<!-- =========================
     EXISTING SLIDERS
========================= -->
<h3
  style="
    margin-bottom:15px;
  "
>
  Uploaded Sliders
</h3>

<div
  style="
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
    gap:20px;
  "
>
  <% sliders.forEach(slide => { %>

    <div
      style="
        border:1px solid #ddd;
        border-radius:6px;
        padding:10px;
        background:#ffffff;
        text-align:center;
      "
    >

      <img
        src="/uploads/sliders/<%= slide.image %>"
        style="
          width:100%;
          height:120px;
          object-fit:cover;
          border-radius:4px;
        "
      >

      <a
        href="/admin/sliders/delete/<%= slide.id %>"
        onclick="return confirm('Delete this slider?')"
        style="
          display:block;
          margin-top:10px;
          color:#ffffff;
          background:#e53935;
          padding:6px;
          border-radius:4px;
          text-decoration:none;
          font-size:13px;
        "
      >
        Delete
      </a>

    </div>

  <% }) %>
</div>

<!-- =========================
     CROPPER SCRIPT
========================= -->
<script>
  let cropper;

  const imageInput = document.getElementById("imageInput");
  const cropImage = document.getElementById("cropImage");
  const cropHint = document.getElementById("cropHint");

  imageInput.addEventListener("change", function () {

    const file = this.files[0];

    if (!file) {
      return;
    }

    const reader = new FileReader();

    reader.onload = function (e) {

      cropImage.src = e.target.result;
      cropImage.style.display = "block";
      cropHint.style.display = "none";

      if (cropper) {
        cropper.destroy();
      }

      cropper = new Cropper(cropImage, {
        aspectRatio: 16 / 5,
        viewMode: 1,
        autoCropArea: 1,
        responsive: true
      });

    };

    reader.readAsDataURL(file);

  });

  function uploadCroppedSlider() {

    if (!cropper) {
      alert("Please select and crop an image first");
      return;
    }

    cropper
      .getCroppedCanvas({
        width: 1200,
        height: 375
      })
      .toBlob(function (blob) {

        const formData = new FormData();
        formData.append("image", blob, "slider.png");

        fetch("/admin/sliders/add", {
          method: "POST",
          body: formData
        })
        .then(() => {
          window.location.reload();
        })
        .catch(() => {
          alert("Upload failed");
        });

      });

  }
</script>
