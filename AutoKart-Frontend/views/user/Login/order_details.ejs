<%- include('../partials/header') %>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Order Details | AutoKart</title>

  <style>
    body {
      margin: 0;
      background: #f1f3f6;
      font-family: Arial, Helvetica, sans-serif;
    }

    /* ===============================
       FULL WIDTH CONTAINER
    ================================ */
    .order-wrapper {
      width: 100%;
      padding: 20px 0;
    }

    .order-container {
  max-width: 1400px;
  margin: auto;
  display: flex;
  gap: 20px;
  align-items: flex-start; /* ðŸ”¥ THIS IS THE FIX */
}


    /* ===============================
       LEFT SECTION (PRODUCT + TIMELINE)
    ================================ */
    .order-left {
      flex: 2.5;
      background: #ffffff;
      border-radius: 4px;
      padding: 20px;
    }

    .product-row {
      display: flex;
      gap: 20px;
      border-bottom: 1px solid #eee;
      padding-bottom: 20px;
    }

    .product-row img {
  width: 180px;
  height: 180px;
  object-fit: contain;
  border: 1px solid #f0f0f0;
  padding: 8px;
  background: #fff;
}


    .product-info h2 {
      font-size: 18px;
      font-weight: 500;
      margin-bottom: 6px;
      color: #212121;
    }

    .product-info p {
      font-size: 14px;
      color: #878787;
      margin-bottom: 8px;
    }

    .product-price {
      font-size: 22px;
      font-weight: bold;
      color: #212121;
    }

    /* ===============================
       ORDER TRACKING
    ================================ */
  .tracking {
  margin-top: 30px;
  position: relative; /* ðŸ”¥ REQUIRED */
}
    .tracking-step {
      display: flex;
      align-items: center;
      margin-bottom: 18px;
      font-size: 14px;
      color: #212121;
    }

    .tracking-dot {
      width: 14px;
      height: 14px;
      background: #26a541;
      border-radius: 50%;
      margin-right: 12px;
    }

    .tracking-line {
      width: 2px;
      height: 30px;
      background: #26a541;
      margin-left: 6px;
      margin-bottom: 6px;
    }

    /* ===============================
       RIGHT SECTION
    ================================ */
    .order-right {
  width: 360px;            /* Flipkart-like width */
  display: flex;
  flex-direction: column;
  gap: 16px;
  flex-shrink: 0;          /* ðŸ”¥ prevents wrapping under left */
}

    .info-box {
  background: #ffffff;
  padding: 16px;
  border-radius: 8px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.08);
}

    .info-box h3 {
      font-size: 16px;
      margin-bottom: 12px;
      color: #212121;
    }

    .info-box p {
      font-size: 14px;
      color: #555;
      margin-bottom: 6px;
    }

    .price-row {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      margin-bottom: 8px;
    }

    .price-total {
      font-size: 16px;
      font-weight: bold;
      margin-top: 10px;
      border-top: 1px solid #eee;
      padding-top: 10px;
    }

    .invoice-btn {
      margin-top: 12px;
      padding: 10px;
      border: 1px solid #2874f0;
      color: #2874f0;
      text-align: center;
      cursor: pointer;
      border-radius: 4px;
      font-weight: 500;
    }

    /* ===============================
   LEFT SIDE FONT TUNING
================================ */

.order-left .product-info h2 {
  font-size: 15px;
  font-weight: 500;
}

.order-left .product-info p {
  font-size: 12px;
}

.order-left .product-price {
  font-size: 18px;
  font-weight: 600;
}

.order-left .tracking-step {
  font-size: 13px;
}

.tracking-dot.inactive {
  background: #ccc;
}

.tracking-line.inactive {
  background: #ccc;
}
.order-right {
  position: sticky;
  top: 80px; /* stays visible while scrolling */
  align-self: flex-start;
}

.cancel-order-box {
  position: absolute;
  bottom: 0;
  right: 0;
}

.cancel-btn {
  padding: 6px 12px;
  background: #fff;
  border: 1px solid #9a9191;
  color: #000000;
  border-radius: 4px;
  cursor: pointer;
  font-size: 13px;
  font-weight: 500;
}

.cancel-btn:hover {
  background: #fff5f5;
}
/* =================================================
   ðŸ”¥ MOBILE RESPONSIVE â€“ NO CUT (FINAL)
================================================= */
@media (max-width: 768px) {

  /* ðŸ”¥ GLOBAL SAFETY */
  html, body {
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
  }

  * {
    box-sizing: border-box;
  }

  /* ðŸ”¥ HEADER SAFE SPACE (iPhone notch fix) */
  body {
    padding-top: 8px;
  }

  .order-wrapper {
    padding: 14px 10px;
    width: 100%;
  }

  .order-container {
    flex-direction: column;
    gap: 12px;
    width: 100%;
    max-width: 100%;
  }

  .order-left {
    padding: 14px;
    width: 100%;
    max-width: 100%;
  }

  /* ======================
     PRODUCT ROW FIX
  ====================== */
  .product-row {
    flex-direction: column;
    gap: 12px;
    width: 100%;
    max-width: 100%;
    padding-bottom: 34px; /* ðŸ”¥ cancel button space */
    overflow: visible;
  }

  .product-row img {
    width: 120px;
    height: 120px;
    max-width: 100%;
  }

  .product-info {
    width: 100%;
    max-width: 100%;
  }

  /* ======================
     CANCEL BUTTON FIX
  ====================== */
  .cancel-order-box {
    position: absolute;
    bottom: 0;
    right: 0;
    max-width: 100%;
  }

  .cancel-btn {
    font-size: 12px;
    padding: 6px 10px;
    white-space: nowrap;
  }

  /* ======================
     TRACKING FIX
  ====================== */
  .tracking {
    width: 100%;
    overflow: visible;
  }

  /* ======================
     RIGHT SECTION
  ====================== */
  .order-right {
    width: 100%;
    max-width: 100%;
    position: static;
  }

  .info-box {
    padding: 14px;
  }

  .info-box h3 {
    font-size: 15px;
  }

  .price-row {
    font-size: 13px;
  }

  .price-total {
    font-size: 15px;
  }

  .invoice-btn {
    width: 100%;
    font-size: 14px;
  }
}

</style>
</head>

<body>
<%
  const statusFlow = [
    "PLACED",
    "CONFIRMED",
    "SHIPPED",
    "OUT_FOR_DELIVERY",
    "DELIVERED"
  ];

  const currentStatusIndex = statusFlow.indexOf(order.order_status);
%>

<div class="order-wrapper">
  <div class="order-container">

    <!-- ===============================
         LEFT
    ================================ -->
  <div class="order-left">

  <% items.forEach(item => { %>

    <div class="product-row">
      <img 
        src="/uploads/<%= item.product_image %>" 
        alt="<%= item.product_name %>"
      >

      <div class="product-info">
        <h2><%= item.product_name %></h2>
        <p>Seller: AutoKart</p>

        <div class="product-price">
          â‚¹<%= (item.price * item.quantity).toFixed(2) %>
        </div>

        <p>Qty: <%= item.quantity %></p>
      </div>
    </div>

  <% }) %>





  <!-- ORDER TRACKING -->
  <div class="tracking">

  <% statusFlow.forEach((status, index) => { %>

    <div class="tracking-step">
      <div class="tracking-dot <%= index <= currentStatusIndex ? '' : 'inactive' %>"></div>

      <% if (status === 'PLACED') { %>
        Order Placed â€” <%= new Date(order.created_at).toDateString() %>
      <% } else if (status === 'CONFIRMED') { %>
        Order Confirmed
      <% } else if (status === 'SHIPPED') { %>
        Shipped
      <% } else if (status === 'OUT_FOR_DELIVERY') { %>
        Out for Delivery
      <% } else if (status === 'DELIVERED') { %>
        Delivered
      <% } %>
    </div>

    <% if (index < statusFlow.length - 1) { %>
      <div class="tracking-line <%= index < currentStatusIndex ? '' : 'inactive' %>"></div>
    <% } %>

  <% }) %>
<% if (['PLACED', 'CONFIRMED'].includes(order.order_status)) { %>
  <form 
    action="/orders/<%= order.order_id %>/cancel" 
    method="POST"
    onsubmit="return confirm('Are you sure you want to cancel this order?');"
    class="cancel-order-box"
  >
    <button type="submit" class="cancel-btn">
      Cancel Order
    </button>
  </form>
<% } %>

</div>

</div>


<!-- ===============================
     RIGHT SIDE (STICKY INFO BOXES)
=============================== -->
<div class="order-right">

  <!-- DELIVERY DETAILS -->
  <div class="info-box">
    <h3>Delivery details</h3>

    <p style="font-size:13px; color:#212121; font-weight:500;">
      <%= order.address_type %>
    </p>

    <p style="font-size:13px; color:#555; line-height:1.4;">
      <%= order.address_line %>,
      <%= order.city %>,
      <%= order.state %> - <%= order.pincode %>
    </p>

    <hr style="border:none; border-top:1px solid #eee; margin:12px 0;">

    <p style="font-size:13px;">
      <strong><%= order.full_name %></strong> Â· <%= order.mobile %>
    </p>
  </div>

  <!-- PRICE DETAILS -->
  <div class="info-box">
    <h3>Price details</h3>

    <div class="price-row">
      <span>Item price</span>
      <span>â‚¹<%= totalAmount.toFixed(2) %></span>
    </div>

    <div class="price-row">
      <span>Delivery fee</span>
      <span style="color:green;">FREE</span>
    </div>

    <hr style="border:none; border-top:1px dashed #ddd; margin:10px 0;">

    <div class="price-row price-total">
      <span>Total amount</span>
      <span>â‚¹<%= totalAmount.toFixed(2) %></span>
    </div>
  </div>

  <!-- PAYMENT METHOD -->
  <div class="info-box">
    <h3>Payment method</h3>

    <p style="font-size:13px;">
      <%= order.payment_method.toUpperCase() %>
    </p>

    <a
      href="/orders/<%= order.order_id %>/invoice"
      class="invoice-btn"
      style="margin-top:12px; display:block; text-decoration:none;"
    >
      Download Invoice
    </a>
  </div>

</div>


      </div>

    </div>

  </div>
</div>

</body>
</html>
