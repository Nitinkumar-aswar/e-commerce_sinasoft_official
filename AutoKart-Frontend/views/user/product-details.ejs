<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title><%= product.product_name %> | AutoKart</title>

  <style>
/* =========================
   BASE
========================= */
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f1f3f6;
}

/* ===== TOP CENTER TOAST ===== */
.cart-toast {
  position: fixed;
  top: -60px;
  left: 50%;
  transform: translateX(-50%);
  background: #323232;
  color: #fff;
  padding: 12px 24px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  z-index: 99999;
  transition: top 0.4s ease;
}
.cart-toast.show { top: 20px; }

/* CART COUNT */
#cart-count.cart-bounce {
  transform: scale(1.5);
  transition: transform 0.3s ease;
}

/* =========================
   DESKTOP LAYOUT (DEFAULT)
========================= */
.product-page {
  max-width: 1200px;
  margin: 30px auto;
  background: #ffffff;
  padding: 24px 32px;
  display: flex;
  gap: 48px;
}

.product-left { width: 45%; }
.product-right { width: 55%; }

/* IMAGE GALLERY */
.image-gallery {
  display: flex;
  gap: 16px;
}

.thumbnail-column {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.thumbnail-column img {
  width: 72px;
  height: 72px;
  object-fit: contain;
  border: 1px solid #e0e0e0;
  cursor: pointer;
  background: #fff;
}

.thumbnail-column img:hover {
  border: 2px solid #2874f0;
}

/* MAIN IMAGE */
.image-wrapper {
  width: 420px;
  height: 420px;
  border: 1px solid #e0e0e0;
  background: #fff;
}
.image-wrapper img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

/* PRODUCT INFO */
.product-title {
  font-size: 22px;
  font-weight: 500;
  color: #212121;
  margin-bottom: 10px;
}

.product-price {
  font-size: 26px;
  font-weight: 600;
  color: #388e3c;
  margin: 12px 0;
}

.product-description-title {
  font-size: 16px;
  font-weight: 600;
  margin-top: 24px;
}

.product-description {
  font-size: 14px;
  color: #555;
  line-height: 1.6;
}

/* DESKTOP BUTTONS */
.action-buttons {
  margin-top: 18px;
  display: flex;
  gap: 14px;
}

.add-cart-btn,
.buy-now-btn {
  width: 180px;
  height: 48px;
  font-size: 14px;
  font-weight: 600;
  border-radius: 4px;
  border: none;
  cursor: pointer;
  color: #fff;
}

.add-cart-btn { background: #ff9f00; }
.buy-now-btn { background: #fb641b; }

/* =========================
   MOBILE ONLY
========================= */
@media (max-width: 768px) {

  .product-page {
    max-width: 100%;
    margin: 0;
    padding: 12px;
    gap: 16px;
    flex-direction: column;
  }

  .product-left,
  .product-right {
    width: 100%;
  }

  .image-gallery {
    flex-direction: column;
  }

  .image-wrapper {
    width: 100%;
    height: 280px;
  }

  .thumbnail-column {
    flex-direction: row;
    overflow-x: auto;
    gap: 8px;
  }

  .thumbnail-column img {
    width: 60px;
    height: 60px;
  }

  /* üî• STICKY BOTTOM BAR */
  .action-buttons {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: #ffffff;
    padding: 10px 12px;
    gap: 12px;
    border-top: 1px solid #e0e0e0;
    z-index: 9999;
  }

  .add-cart-btn {
    width: 50%;
    height: 46px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    background: #ff9f00; /* SAME DARK */
  }

  .buy-now-form { width: 50%; }

  .buy-now-form button {
    width: 100%;
    height: 46px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    background: #fb641b; /* SAME DARK */
    color: #fff;
    border: none;
  }

  /* space for sticky bar */
  .product-page {
    padding-bottom: 90px;
  }

  /* disable zoom */
  #lens,
  .zoom-preview {
    display: none !important;
  }
}
</style>

</head>


<body>

<%- include('partials/header') %>
  <div id="cart-toast" class="cart-toast">Added to cart</div>
<div class="product-page">

  <!-- LEFT SIDE -->
  <div class="product-left">

    <!-- IMAGE GALLERY -->
    <div class="image-gallery">

      <!-- THUMBNAILS -->
      <div class="thumbnail-column">
        <% for (let i = 0; i < 5; i++) { %>
          <% if (images && images[i]) { %>
            <img
              src="/uploads/<%= images[i].image %>"
              onclick="changeImage('/uploads/<%= images[i].image %>')"
            >
          <% } else { %>
            <div class="thumbnail-placeholder"></div>
          <% } %>
        <% } %>
      </div>

      <!-- MAIN IMAGE -->
      <div class="image-zoom-container">
        <div class="image-wrapper">
          <img
            id="mainImage"
            src="/uploads/<%= product.image %>"
            alt="<%= product.product_name %>"
          >
          <div id="lens"></div>
        </div>
        <div class="zoom-preview" id="zoomPreview"></div>
      </div>

    </div>

    <!-- BUTTONS -->
    <div class="action-buttons">
      <button
        class="add-cart-btn"
        data-product-id="<%= product.id %>"
      >
        ADD TO CART
      </button>

     <form action="/create-checkout" method="POST" class="buy-now-form">
  <input type="hidden" name="product_id" value="<%= product.id %>">
  <button type="submit" class="buy-now-btn">
    BUY NOW
  </button>
</form>



                

    </div>

  </div>

  <!-- RIGHT SIDE -->
  <div class="product-right">

    <div class="product-title">
      <%= product.product_name %>
    </div>

    <div class="product-price">
      ‚Çπ <%= product.price %>
    </div>

    <div class="product-description-title">
      Description
    </div>

    <div class="product-description">
      <%= product.product_description || "No description available." %>
    </div>

  </div>

</div>


<!-- Custom Alert Modal -->
<!-- <div id="cart-modal" class="modal-overlay">
  <div class="modal-box">
    <h3>Added to cart</h3>
    <button onclick="closeCartModal()">OK</button>
  </div>
</div> -->

  <script>
const mainImage = document.getElementById("mainImage");
const lens = document.getElementById("lens");
const zoomPreview = document.getElementById("zoomPreview");

const zoomLevel = 2.5;



function moveLens(e) {
  e.preventDefault();

  const rect = mainImage.getBoundingClientRect();
  let x = e.clientX - rect.left - lens.offsetWidth / 2;
  let y = e.clientY - rect.top - lens.offsetHeight / 2;

  if (x < 0) x = 0;
  if (y < 0) y = 0;
  if (x > rect.width - lens.offsetWidth)
    x = rect.width - lens.offsetWidth;
  if (y > rect.height - lens.offsetHeight)
    y = rect.height - lens.offsetHeight;

  lens.style.left = x + "px";
  lens.style.top = y + "px";

  const fx = (x / rect.width) * 100;
  const fy = (y / rect.height) * 100;

  zoomPreview.style.backgroundPosition = `${fx}% ${fy}%`;
  zoomPreview.style.backgroundSize =
    rect.width * zoomLevel + "px " +
    rect.height * zoomLevel + "px";
}

mainImage.addEventListener("mouseenter", () => {
  lens.style.display = "block";
  zoomPreview.style.display = "block";
  zoomPreview.style.backgroundImage = `url(${mainImage.src})`;
});


mainImage.addEventListener("mouseleave", () => {
  lens.style.display = "none";
  zoomPreview.style.display = "none";
});

mainImage.addEventListener("mousemove", moveLens);
lens.addEventListener("mousemove", moveLens);
</script>

<script>
function changeImage(src) {
  const mainImage = document.getElementById("mainImage");
  const zoomPreview = document.getElementById("zoomPreview");

  mainImage.src = src;
  zoomPreview.style.backgroundImage = `url(${src})`;
}
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {

  /* ================= IMAGE ZOOM ================= */
  const mainImage = document.getElementById("mainImage");
  const lens = document.getElementById("lens");
  const zoomPreview = document.getElementById("zoomPreview");
  const zoomLevel = 2.5;

  function moveLens(e) {
    const rect = mainImage.getBoundingClientRect();
    let x = e.clientX - rect.left - lens.offsetWidth / 2;
    let y = e.clientY - rect.top - lens.offsetHeight / 2;

    x = Math.max(0, Math.min(x, rect.width - lens.offsetWidth));
    y = Math.max(0, Math.min(y, rect.height - lens.offsetHeight));

    lens.style.left = x + "px";
    lens.style.top = y + "px";

    const fx = (x / rect.width) * 100;
    const fy = (y / rect.height) * 100;

    zoomPreview.style.backgroundPosition = `${fx}% ${fy}%`;
    zoomPreview.style.backgroundSize =
      rect.width * zoomLevel + "px " +
      rect.height * zoomLevel + "px";
  }

  if (mainImage) {
    mainImage.addEventListener("mouseenter", () => {
      lens.style.display = "block";
      zoomPreview.style.display = "block";
      zoomPreview.style.backgroundImage = `url(${mainImage.src})`;
    });

    mainImage.addEventListener("mouseleave", () => {
      lens.style.display = "none";
      zoomPreview.style.display = "none";
    });

    mainImage.addEventListener("mousemove", moveLens);
    lens.addEventListener("mousemove", moveLens);
  }

  /* ================= THUMB CHANGE ================= */
  window.changeImage = function (src) {
    mainImage.src = src;
    zoomPreview.style.backgroundImage = `url(${src})`;
  };

  /* ================= TOP TOAST ================= */
  function showToast(msg) {
    const toast = document.getElementById("cart-toast");
    if (!toast) return;

    toast.innerText = msg;
    toast.classList.add("show");

    setTimeout(() => {
      toast.classList.remove("show");
    }, 2000);
  }

  /* ================= ADD TO CART ================= */
  const addCartBtn = document.querySelector(".add-cart-btn");

  if (addCartBtn) {
    addCartBtn.addEventListener("click", function () {

      const productId = this.dataset.productId;

      fetch("/add-to-cart", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ productId, qty: 1 })
      })
      .then(res => res.json())
      .then(data => {

        if (data.success) {

          /* CART COUNT */
          const cartCountEl = document.getElementById("cart-count");
          if (cartCountEl) {
            let count = parseInt(cartCountEl.innerText) || 0;
            cartCountEl.innerText = count + 1;
            cartCountEl.style.display = "inline-block";
            cartCountEl.classList.add("cart-bounce");
            setTimeout(() => cartCountEl.classList.remove("cart-bounce"), 300);
          }

          /* üî• TOP CENTER POP */
          showToast("‚úÖ Product added to cart");

        } else {
          showToast("‚ùå Failed to add product");
        }

      })
      .catch(() => showToast("‚ö†Ô∏è Server error"));
    });
  }

});
</script>







</body>
</html>