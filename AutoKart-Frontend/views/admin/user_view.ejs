<!-- =========================
     USER INFORMATION
========================= -->

<div style="background:#fff;padding:20px;border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,0.08);">

  <h3 style="margin-bottom:12px;font-size:18px;">ðŸ‘¤ User Information</h3>

  <% if (data.length > 0) { %>
    <p style="font-size:14px;margin:4px 0;">
      <b>User ID:</b> <%= data[0].user_id %>
    </p>
    <p style="font-size:14px;margin:4px 0;">
      <b>Name:</b> <%= data[0].user_first_name %> <%= data[0].user_last_name %>
    </p>
    <p style="font-size:14px;margin:4px 0;">
      <b>Username:</b> <%= data[0].user_user_name %>
    </p>
    <p style="font-size:14px;margin:4px 0;">
      <b>Email:</b> <%= data[0].user_email %>
    </p>
  <% } %>

  <hr style="margin:16px 0;">

  <!-- =========================
       PURCHASE HISTORY
  ========================= -->

  <h4 style="margin-bottom:10px;font-size:16px;">ðŸ“¦ Purchase History</h4>

  <div style="overflow-x:auto;">

    <table
      width="100%"
      cellpadding="8"
      cellspacing="0"
      style="
        border-collapse:collapse;
        font-family:Arial;
        font-size:13px;
      "
    >
      <thead>
        <tr style="background:#f2f2f2;color:#000;">
          <th style="border:1px solid #e0e0e0;text-align:center;">Sr No</th>
          <th style="border:1px solid #e0e0e0;">Product</th>
          <th style="border:1px solid #e0e0e0;">Price</th>
          <th style="border:1px solid #e0e0e0;">Qty</th>
          <th style="border:1px solid #e0e0e0;">Payment</th>
          <th style="border:1px solid #e0e0e0;">Date</th>
        </tr>
      </thead>

      <tbody>
        <%
          let srno = 1;
          let totalAmount = 0;
          let orderFound = false;

          data.forEach(row => {
            if (row.order_product_id) {
              orderFound = true;
              totalAmount += row.order_price * row.order_qty;
        %>

        <tr>
          <td style="border:1px solid #e0e0e0;text-align:center;">
            <%= srno++ %>
          </td>

          <td style="border:1px solid #e0e0e0;">
            <%= row.order_product_name %>
          </td>

          <td style="border:1px solid #e0e0e0;">
            â‚¹ <%= row.order_price %>
          </td>

          <td style="border:1px solid #e0e0e0;">
            <%= row.order_qty %>
          </td>

          <td style="border:1px solid #e0e0e0;">
            <% if (row.payment_status === "Paid") { %>
              <span style="color:#2e7d32;font-weight:600;">Paid</span>
            <% } else { %>
              <span style="color:#555;font-weight:500;">Pending</span>
            <% } %>
          </td>

          <td style="border:1px solid #e0e0e0;">
            <%= row.order_date %>
          </td>
        </tr>

        <% } }); %>

        <% if (!orderFound) { %>
          <tr>
            <td colspan="6" style="border:1px solid #e0e0e0;text-align:center;color:#777;">
              No purchases found
            </td>
          </tr>
        <% } else { %>
          <tr>
            <td colspan="4"></td>
            <td style="border:1px solid #e0e0e0;font-weight:bold;">
              Total Amount
            </td>
            <td style="border:1px solid #e0e0e0;font-weight:bold;">
              â‚¹ <%= totalAmount %>
            </td>
          </tr>
        <% } %>

      </tbody>
    </table>

  </div>
</div>
