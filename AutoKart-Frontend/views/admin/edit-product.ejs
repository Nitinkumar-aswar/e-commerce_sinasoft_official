<!DOCTYPE html>
<html>
<head>
  <title>Edit Product</title>
</head>
<style>
   /* ================= RESPONSIVE ================= */

    /* Mobile ≤480px */
    @media (max-width: 480px) {
      body {
        padding: 10px;
      }

      form {
        padding: 15px;
      }

      .gallery-preview div {
        width: 60px;
      }

      .gallery-preview img {
        width: 60px;
        height: 60px;
      }

      button {
        font-size: 14px;
        padding: 10px;
      }
    }

    /* Tablet 481px – 768px */
    @media (min-width: 481px) and (max-width: 768px) {
      form {
        max-width: 600px;
      }

      .gallery-preview div {
        width: 65px;
      }

      .gallery-preview img {
        width: 65px;
        height: 65px;
      }
    }

    /* Laptop 769px – 1024px */
    @media (min-width: 769px) and (max-width: 1024px) {
      form {
        max-width: 700px;
      }

      .gallery-preview div {
        width: 70px;
      }

      .gallery-preview img {
        width: 70px;
        height: 70px;
      }
    }

    /* Desktop ≥1025px */
    @media (min-width: 1025px) {
      form {
        max-width: 800px;
      }
    }
</style>
<body>

<h2>Edit Product</h2>

<form
  method="POST"
  action="/admin/products/edit/<%= product.id %>"
  enctype="multipart/form-data"
>

  <!-- =========================
       SECTION
  ========================= -->
  <label>Section</label>
  <select name="section_id">
    <% sections.forEach(section => { %>
      <option
        value="<%= section.id %>"
        <%= section.id === product.section_id ? "selected" : "" %>
      >
        <%= section.name %>
      </option>
    <% }) %>
  </select>

  <br><br>

  <!-- =========================
       PRODUCT NAME
  ========================= -->
  <label>Product Name</label>
  <input
    type="text"
    name="product_name"
    value="<%= product.product_name %>"
  >

  <br><br>

  <!-- =========================
       QUANTITY
  ========================= -->
  <label>Quantity</label>
  <input
    type="number"
    name="quantity"
    value="<%= product.quantity %>"
  >

  <br><br>

  <!-- =========================
       ORIGINAL PRICE
  ========================= -->
  <label>Original Price (₹)</label>
  <input
    type="number"
    id="originalPrice"
    name="original_price"
    step="0.01"
    value="<%= product.original_price || product.price || '' %>"
    required
  >

  <br><br>
 <!-- =========================
       DISCOUNT
  ========================= -->
  <label>Discount (%)</label>
  <input
    type="number"
    id="discount"
    name="discount"
    min="0"
    max="100"
    step="0.01"
    value="<%= product.discount || '0' %>"
    required
  >

  <br><br>

  <!-- =========================
       FINAL PRICE
  ========================= -->
  <label>Price (₹)</label>
  <input
    type="number"
    id="price"
    name="price"
    step="0.01"
    value="<%= product.price %>"
    readonly
    required
  >

  <br><br>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const originalPrice = document.getElementById('originalPrice');
      const discount = document.getElementById('discount');
      const price = document.getElementById('price');

      function calculatePrice() {
        const original = parseFloat(originalPrice.value) || 0;
        const disc = parseFloat(discount.value) || 0;
        
        if (original > 0) {
          const discountAmount = (original * disc) / 100;
          const finalPrice = (original - discountAmount).toFixed(2);
          price.value = finalPrice;
        } else {
          price.value = original > 0 ? original.toFixed(2) : '';
        }
      }

      // Add event listeners
      originalPrice.addEventListener('input', calculatePrice);
      discount.addEventListener('input', calculatePrice);

      // Initial calculation
      calculatePrice();
    });
  </script>


  <!-- =========================
       DESCRIPTION
  ========================= -->
  <label>Description</label>
  <textarea name="product_description"><%= product.product_description %></textarea>

  <br><br>

  <!-- =========================
       MAIN PRODUCT IMAGE
  ========================= -->
  <label>Change Image (optional)</label>
  <input type="file" name="product_image">

  <br><br>

  <!-- =========================
       GALLERY IMAGES
  ========================= -->
  <label>Gallery Images (Max 5)</label>
  <input type="file" name="gallery_images[]" multiple>

  <br><br>

  <!-- =========================
       EXISTING GALLERY PREVIEW
  ========================= -->
  <div style="display:flex; gap:10px; flex-wrap:wrap;">

    <% if (images && images.length) { %>
      <% images.forEach(img => { %>

        <div style="text-align:center;">

          <img
            src="/uploads/<%= img.image %>"
            style="
              width:70px;
              height:70px;
              object-fit:contain;
              border:1px solid #ccc;
            "
          >

          <br>

          <input
            type="checkbox"
            name="delete_images[]"
            value="<%= img.id %>"
          >
          <small>Remove</small>

        </div>

      <% }) %>
    <% } %>

  </div>

  <br><br>

  <!-- =========================
       SUBMIT
  ========================= -->
  <button type="submit">Update Product</button>

</form>

</body>
</html>
